{"ast":null,"code":"// src/services/weather.js\n// 백엔드 날씨 API 엔드포인트 - 프록시 사용\nconst BACKEND_URL = process.env.REACT_APP_BACKEND_URL || 'http://localhost:8083';\nconst WEATHER_API_URL = process.env.NODE_ENV === \"development\" ? \"/api/v1/weather/ncst\" // CRA 프록시로 /api/v1/* 를 백엔드로 전달\n: `${BACKEND_URL}/api/v1/weather/ncst`;\n\n// (옵션) 한글 상태를 코드로 매핑 (백업용)\nfunction mapConditionToCode(txt = \"\") {\n  const t = String(txt).trim();\n  if (/맑/.test(t)) return \"sunny\";\n  if (/구름|흐림?/.test(t)) return \"cloudy\";\n  if (/비|소나기/.test(t)) return \"rain\";\n  if (/눈|진눈깨비/.test(t)) return \"snow\";\n  return \"sunny\";\n}\n\n// 기상청 단기/초단기예보에 맞는 base_date, base_time 생성 함수\n// eslint-disable-next-line no-unused-vars\nfunction getBaseDateTime() {\n  const now = new Date();\n  const forecastTimes = [2, 5, 8, 11, 14, 17, 20, 23];\n  let hour = now.getHours();\n  let baseHour = forecastTimes[0];\n  for (let i = 0; i < forecastTimes.length; i++) {\n    if (hour >= forecastTimes[i]) baseHour = forecastTimes[i];\n  }\n  let baseDate = now.toISOString().slice(0, 10).replace(/-/g, \"\");\n  if (hour < forecastTimes[0]) {\n    const yesterday = new Date(now.getTime() - 24 * 60 * 60 * 1000);\n    baseDate = yesterday.toISOString().slice(0, 10).replace(/-/g, \"\");\n    baseHour = 23;\n  }\n  const baseTime = String(baseHour).padStart(2, \"0\") + \"00\";\n  return {\n    baseDate,\n    baseTime\n  };\n}\n\n// 실제 API 요청 함수\n// 지역명으로 날씨 데이터 요청 (백엔드 API는 city=서산시로 전체 지역 반환)\nexport async function fetchWeatherData(region = \"서산시\") {\n  const params = new URLSearchParams({\n    city: \"서산시\"\n  });\n  const url = `${WEATHER_API_URL}?${params.toString()}`;\n  console.log(\"날씨 API 호출:\", url, \"요청 지역:\", region);\n  try {\n    const res = await fetch(url);\n    const text = await res.text(); // 로깅/디버깅을 위해 먼저 text로 받음\n\n    let data;\n    try {\n      data = JSON.parse(text);\n      console.log(\"날씨 API 응답:\", data);\n    } catch (jsonError) {\n      console.error(\"날씨 API JSON 파싱 에러:\", text);\n      throw new Error(\"날씨 API 응답을 파싱할 수 없습니다.\");\n    }\n\n    // 백엔드가 에러 포맷을 줄 수 있으니 가드\n    if (data.status && data.status >= 400) {\n      console.error(\"날씨 API 에러 응답:\", data);\n      throw new Error(`날씨 API 에러: ${data.message || \"Unknown error\"}`);\n    }\n\n    // --- 스키마 정규화 ---\n    // 1) 이미 cards가 있는 구(old) 스키마면 그대로 통과\n    if (Array.isArray(data.cards) && data.cards.length > 0) {\n      return data;\n    }\n\n    // 2) 새 스키마: { city, results: [...], count }\n    if (Array.isArray(data.results) && data.results.length > 0) {\n      var _data$count;\n      const cards = data.results.map((r, idx) => ({\n        id: idx,\n        region: r.region,\n        condition: r.condition,\n        // \"맑음\"\n        conditionCode: r.conditionCode || mapConditionToCode(r.condition),\n        // \"sunny\"\n        temperature: r.temperature,\n        humidity: r.humidity,\n        windSpeed: r.windSpeed,\n        windDirection: r.windDirection,\n        baseDate: r.baseDate,\n        baseTime: r.baseTime,\n        nx: r.nx,\n        ny: r.ny\n      }));\n      return {\n        city: data.city || region,\n        count: (_data$count = data.count) !== null && _data$count !== void 0 ? _data$count : cards.length,\n        cards // ✅ UI는 여전히 cards 배열만 보면 됨\n      };\n    }\n    console.error(\"날씨 API 응답에 유효한 데이터가 없음:\", data);\n    throw new Error(\"날씨 데이터를 찾을 수 없습니다.\");\n  } catch (err) {\n    console.error(\"날씨 API 에러:\", err);\n    throw err;\n  }\n}\nexport default {\n  fetchWeatherData\n};","map":{"version":3,"names":["BACKEND_URL","process","env","REACT_APP_BACKEND_URL","WEATHER_API_URL","NODE_ENV","mapConditionToCode","txt","t","String","trim","test","getBaseDateTime","now","Date","forecastTimes","hour","getHours","baseHour","i","length","baseDate","toISOString","slice","replace","yesterday","getTime","baseTime","padStart","fetchWeatherData","region","params","URLSearchParams","city","url","toString","console","log","res","fetch","text","data","JSON","parse","jsonError","error","Error","status","message","Array","isArray","cards","results","_data$count","map","r","idx","id","condition","conditionCode","temperature","humidity","windSpeed","windDirection","nx","ny","count","err"],"sources":["C:/Users/이여재/Desktop/SpringProject/Seosan-Issue-front/src/api/Weather.api.js"],"sourcesContent":["// src/services/weather.js\n// 백엔드 날씨 API 엔드포인트 - 프록시 사용\nconst BACKEND_URL = process.env.REACT_APP_BACKEND_URL || 'http://localhost:8083';\nconst WEATHER_API_URL =\n  process.env.NODE_ENV === \"development\"\n    ? \"/api/v1/weather/ncst\" // CRA 프록시로 /api/v1/* 를 백엔드로 전달\n    : `${BACKEND_URL}/api/v1/weather/ncst`;\n\n// (옵션) 한글 상태를 코드로 매핑 (백업용)\nfunction mapConditionToCode(txt = \"\") {\n  const t = String(txt).trim();\n  if (/맑/.test(t)) return \"sunny\";\n  if (/구름|흐림?/.test(t)) return \"cloudy\";\n  if (/비|소나기/.test(t)) return \"rain\";\n  if (/눈|진눈깨비/.test(t)) return \"snow\";\n  return \"sunny\";\n}\n\n// 기상청 단기/초단기예보에 맞는 base_date, base_time 생성 함수\n// eslint-disable-next-line no-unused-vars\nfunction getBaseDateTime() {\n  const now = new Date();\n  const forecastTimes = [2, 5, 8, 11, 14, 17, 20, 23];\n  let hour = now.getHours();\n\n  let baseHour = forecastTimes[0];\n  for (let i = 0; i < forecastTimes.length; i++) {\n    if (hour >= forecastTimes[i]) baseHour = forecastTimes[i];\n  }\n\n  let baseDate = now.toISOString().slice(0, 10).replace(/-/g, \"\");\n  if (hour < forecastTimes[0]) {\n    const yesterday = new Date(now.getTime() - 24 * 60 * 60 * 1000);\n    baseDate = yesterday.toISOString().slice(0, 10).replace(/-/g, \"\");\n    baseHour = 23;\n  }\n  const baseTime = String(baseHour).padStart(2, \"0\") + \"00\";\n  return { baseDate, baseTime };\n}\n\n// 실제 API 요청 함수\n// 지역명으로 날씨 데이터 요청 (백엔드 API는 city=서산시로 전체 지역 반환)\nexport async function fetchWeatherData(region = \"서산시\") {\n  const params = new URLSearchParams({ city: \"서산시\" });\n  const url = `${WEATHER_API_URL}?${params.toString()}`;\n\n  console.log(\"날씨 API 호출:\", url, \"요청 지역:\", region);\n\n  try {\n    const res = await fetch(url);\n    const text = await res.text(); // 로깅/디버깅을 위해 먼저 text로 받음\n\n    let data;\n    try {\n      data = JSON.parse(text);\n      console.log(\"날씨 API 응답:\", data);\n    } catch (jsonError) {\n      console.error(\"날씨 API JSON 파싱 에러:\", text);\n      throw new Error(\"날씨 API 응답을 파싱할 수 없습니다.\");\n    }\n\n    // 백엔드가 에러 포맷을 줄 수 있으니 가드\n    if (data.status && data.status >= 400) {\n      console.error(\"날씨 API 에러 응답:\", data);\n      throw new Error(`날씨 API 에러: ${data.message || \"Unknown error\"}`);\n    }\n\n    // --- 스키마 정규화 ---\n    // 1) 이미 cards가 있는 구(old) 스키마면 그대로 통과\n    if (Array.isArray(data.cards) && data.cards.length > 0) {\n      return data;\n    }\n\n    // 2) 새 스키마: { city, results: [...], count }\n    if (Array.isArray(data.results) && data.results.length > 0) {\n      const cards = data.results.map((r, idx) => ({\n        id: idx,\n        region: r.region,\n        condition: r.condition, // \"맑음\"\n        conditionCode: r.conditionCode || mapConditionToCode(r.condition), // \"sunny\"\n        temperature: r.temperature,\n        humidity: r.humidity,\n        windSpeed: r.windSpeed,\n        windDirection: r.windDirection,\n        baseDate: r.baseDate,\n        baseTime: r.baseTime,\n        nx: r.nx,\n        ny: r.ny,\n      }));\n\n      return {\n        city: data.city || region,\n        count: data.count ?? cards.length,\n        cards, // ✅ UI는 여전히 cards 배열만 보면 됨\n      };\n    }\n\n    console.error(\"날씨 API 응답에 유효한 데이터가 없음:\", data);\n    throw new Error(\"날씨 데이터를 찾을 수 없습니다.\");\n  } catch (err) {\n    console.error(\"날씨 API 에러:\", err);\n    throw err;\n  }\n}\n\nexport default {\n  fetchWeatherData,\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}